import{c as Ne,r,j as e,B as z,_ as De,a as We,u as Pe,s as He,A as _e,d as Oe}from"./supabase.js";/**
 * @license lucide-react v0.534.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],Ae=Ne("message-circle",Le),$e=["MRI Ankle","MRI Foot","MRI Knee","MRI Hip","MRI Shoulder","MRI Elbow","MRI Wrist","MRI Hand","MRI Cervical Spine","MRI Thoracic Spine","MRI Lumbar Spine","MRI Total Spine","DEXA","CT Generic","MRI Generic","CT Abdomen Pelvis","CT Pulmonary Embolism","CT Chest","CT Head","Knee Test Template"];function Ue({templates:i,onSave:C,onSaveWithAgentLogic:x,isOfflineMode:m}){const I=[...new Set([...$e,...Object.keys(i)])],[T,E]=r.useState(I[0]||""),[Z,f]=r.useState(null),[b,k]=r.useState(!1),[y,L]=r.useState(""),[M,O]=r.useState(""),[W,g]=r.useState({}),h=r.useRef(null),F=r.useRef(null),S=r.useRef(null);r.useEffect(()=>{I.length>0&&E(I[0])},[i]);const $=()=>{h.current&&g(p=>({...p,[T]:{...p[T],template:h.current.value}}))};r.useEffect(()=>{f(null)},[T]),r.useEffect(()=>{g(p=>{const R={...p};let G=!1;return Object.keys(R).forEach(X=>{const ee=R[X],le=i[X];le&&ee.template===le.template&&(delete R[X],G=!0)}),G?R:p})},[i]);const B=async()=>{var p;try{$(),await new Promise(X=>setTimeout(X,10));const R=W[T]||{},G=i[T]||{};await C(T,R.template??((p=h.current)==null?void 0:p.value)??G.template??"",G.generate_prompt??"",G.generate_impression??"",R.showDiffView??G.showDiffView??!0)}catch(R){console.error(R),f("❌ Save failed")}},v=async()=>{if(!y.trim()||!M.trim()){f("❌ Please provide both study type name and template");return}if(I.includes(y)){f("❌ Study type already exists");return}try{const{createDefaultAgentLogic:p}=await De(()=>import("./defaultAgentLogic.js"),[],import.meta.url),R=p(y);x?await x(y,M,R,!0):await C(y,M,"","",!0),L(""),O(""),k(!1),E(y),f(`✅ Created "${y}" with default agent logic`),setTimeout(()=>f(null),3e3)}catch(p){console.error(p),f("❌ Failed to create new study type")}},U=()=>{L(""),O(""),k(!1),f(null)},V=i[T]||{},P=W[T]||{},Y={template:P.template??V.template??"",showDiffView:P.showDiffView??V.showDiffView??!0};return e.jsxs("div",{style:{marginTop:20,paddingTop:16,width:"90%",margin:"20px auto 0 auto",paddingLeft:20,paddingRight:20},children:[e.jsxs("p",{style:{fontSize:12,marginBottom:8,color:"#fff"},children:["Loaded ",i?Object.keys(i).length:0," templates",m?" (Offline Mode)":"","."]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:16},children:[e.jsx("div",{children:e.jsx(z,{children:e.jsx("button",{className:"radpal-button radpal-button-impression",onClick:()=>k(!0),style:{border:"none",backgroundColor:"#2a9b7a"},children:"+ Add New"})})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx(z,{children:e.jsx("button",{className:"radpal-button radpal-button-impression",onClick:B,style:{border:"none"},children:" Save "})}),Z&&e.jsx("span",{style:{fontSize:13,color:"#fff"},children:Z})]})]}),e.jsx("label",{style:{fontSize:"15px",fontWeight:400,marginBottom:6,display:"block",color:"#fff"},children:"Select Study Type:"}),e.jsx(z,{children:e.jsx("select",{value:T,onChange:p=>{$(),E(p.target.value)},style:{width:"100%",fontSize:"16px",padding:"12px 16px",borderRadius:12,backgroundColor:"transparent",color:"#fff",border:"none",outline:"none",fontFamily:"'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif",fontWeight:500},children:I.map(p=>e.jsx("option",{value:p,style:{fontSize:"16px",backgroundColor:"#1a1d23",color:"#fff",padding:"8px 12px",fontFamily:"'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif",fontWeight:400},children:p},p))})}),e.jsx("div",{style:{marginBottom:16}}),e.jsx(z,{children:e.jsx("textarea",{ref:h,value:Y.template,onChange:p=>{g(R=>({...R,[T]:{template:p.target.value}}))},style:{width:"100%",height:700,marginBottom:30,fontSize:"16px",fontFamily:"'JetBrains Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace",backgroundColor:"transparent",color:"#fff",border:"none",outline:"none",resize:"none"}})}),e.jsx("div",{style:{marginTop:20,marginBottom:20},children:e.jsx(z,{children:e.jsxs("div",{style:{padding:"12px 16px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("label",{style:{fontSize:"14px",fontWeight:400,color:"#fff",display:"flex",alignItems:"center",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:Y.showDiffView,onChange:p=>{g(R=>{var G;return{...R,[T]:{...R[T],template:((G=h.current)==null?void 0:G.value)??Y.template,showDiffView:p.target.checked}}})},style:{marginRight:8,width:16,height:16,cursor:"pointer"}}),"Show Diff View When Generating Report"]}),e.jsx("span",{style:{fontSize:"12px",color:"#999",marginLeft:16},children:Y.showDiffView?"Enabled":"Disabled"})]})})}),b&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsx(z,{style:{width:"90%",maxWidth:600,maxHeight:"80vh",overflow:"auto"},children:e.jsxs("div",{style:{padding:20},children:[e.jsx("h3",{style:{color:"#fff",marginBottom:20,fontSize:18},children:"Add New Study Type"}),e.jsx("label",{style:{fontSize:"14px",fontWeight:400,marginBottom:6,display:"block",color:"#fff"},children:"Study Type Name:"}),e.jsx("input",{ref:F,type:"text",value:y,onChange:p=>L(p.target.value),placeholder:"e.g., MRI Brain, CT Abdomen",style:{width:"100%",fontSize:"16px",padding:"12px 16px",marginBottom:20,borderRadius:12,backgroundColor:"rgba(255, 255, 255, 0.1)",color:"#fff",border:"1px solid rgba(255, 255, 255, 0.2)",outline:"none",fontFamily:"'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif"}}),e.jsx("label",{style:{fontSize:"14px",fontWeight:400,marginBottom:6,display:"block",color:"#fff"},children:"Template Structure:"}),e.jsx("textarea",{ref:S,value:M,onChange:p=>O(p.target.value),placeholder:`FINDINGS:
[Describe findings here]

IMPRESSION:
[Summary of findings]`,style:{width:"100%",height:300,fontSize:"14px",padding:"12px 16px",marginBottom:20,borderRadius:12,backgroundColor:"rgba(255, 255, 255, 0.1)",color:"#fff",border:"1px solid rgba(255, 255, 255, 0.2)",outline:"none",resize:"vertical",fontFamily:"'JetBrains Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace"}}),e.jsx("p",{style:{fontSize:12,color:"#aaa",marginBottom:20},children:'A default agent logic will be created automatically. You can customize it later using "Edit Logic".'}),e.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"flex-end"},children:[e.jsx("button",{onClick:U,style:{padding:"10px 20px",borderRadius:12,backgroundColor:"rgba(255, 255, 255, 0.1)",color:"#fff",border:"1px solid rgba(255, 255, 255, 0.2)",cursor:"pointer",fontSize:14},children:"Cancel"}),e.jsx("button",{onClick:v,style:{padding:"10px 20px",borderRadius:12,backgroundColor:"#3ABC96",color:"#fff",border:"none",cursor:"pointer",fontSize:14},children:"Create Study Type"})]})]})})})]})}const Ve=["MRI Ankle","MRI Foot","MRI Knee","MRI Hip","MRI Shoulder","MRI Elbow","MRI Wrist","MRI Hand","MRI Cervical Spine","MRI Thoracic Spine","MRI Lumbar Spine","MRI Total Spine","DEXA","CT Generic","MRI Generic","CT Abdomen Pelvis","CT Pulmonary Embolism","CT Chest","CT Head","Knee Test Template"];function Ye({templates:i,onSave:C}){const x=[...new Set([...Ve,...Object.keys(i)])],[m,I]=r.useState(x[0]||""),[T,E]=r.useState(null),[Z,f]=r.useState({}),b=r.useRef(null),k=r.useRef(null);r.useEffect(()=>{x.length>0&&!x.includes(m)&&I(x[0])},[i,x,m]);const y=()=>{b.current&&k.current&&f(g=>({...g,[m]:{generate_prompt:b.current.value,generate_impression:k.current.value}}))};r.useEffect(()=>{f(g=>{const h={...g};let F=!1;return Object.keys(i).forEach(S=>{const $=i[S],B=g[S];(!B||B.generate_prompt!==$.generate_prompt||B.generate_impression!==($.generate_impression||""))&&(h[S]={generate_prompt:$.generate_prompt||"",generate_impression:$.generate_impression||""},F=!0)}),F?h:g})},[i]);const L=async()=>{var g,h;try{y(),await new Promise($=>setTimeout($,10));const F=Z[m]||{},S=i[m]||{};await C(m,S.template??"",F.generate_prompt??((g=b.current)==null?void 0:g.value)??S.generate_prompt??"",F.generate_impression??((h=k.current)==null?void 0:h.value)??S.generate_impression??"")}catch(F){console.error(F),E("❌ Save failed")}},M=i[m]||{},O=Z[m]||{},W={generate_prompt:O.generate_prompt??M.generate_prompt??"",generate_impression:O.generate_impression??M.generate_impression??""};return e.jsxs("div",{style:{marginTop:20,paddingTop:16,width:"90%",margin:"20px auto 0 auto",paddingLeft:20,paddingRight:20},children:[e.jsxs("p",{style:{fontSize:12,marginBottom:8,color:"#fff"},children:["Loaded ",i?Object.keys(i).length:0," templates."]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:12,marginBottom:16},children:[e.jsx(z,{children:e.jsx("button",{className:"radpal-button radpal-button-impression",onClick:L,style:{border:"none"},children:" Save "})}),T&&e.jsx("span",{style:{fontSize:13,color:"#fff"},children:T})]}),e.jsx("label",{style:{fontSize:"15px",fontWeight:400,marginBottom:6,display:"block",color:"#fff"},children:"Select Study Type:"}),e.jsx(z,{children:e.jsx("select",{value:m,onChange:g=>{y(),I(g.target.value)},style:{width:"100%",fontSize:"16px",padding:"12px 16px",borderRadius:12,backgroundColor:"transparent",color:"#fff",border:"none",outline:"none",fontFamily:"'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif",fontWeight:500},children:x.map(g=>e.jsx("option",{value:g,style:{fontSize:"16px",backgroundColor:"#1a1d23",color:"#fff",padding:"8px 12px",fontFamily:"'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif",fontWeight:500},children:g},g))})}),e.jsx("div",{style:{marginBottom:16}}),e.jsx(z,{children:e.jsx("textarea",{ref:b,value:W.generate_prompt,onChange:g=>{f(h=>{var F;return{...h,[m]:{...h[m],generate_prompt:g.target.value,generate_impression:((F=h[m])==null?void 0:F.generate_impression)??W.generate_impression}}})},style:{width:"100%",height:600,marginBottom:12,fontSize:"16px",fontFamily:"'JetBrains Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace",backgroundColor:"transparent",color:"#fff",border:"none",outline:"none",resize:"none"},placeholder:"Report Logic"})}),e.jsx("div",{style:{marginBottom:16}}),e.jsx(z,{children:e.jsx("textarea",{ref:k,value:W.generate_impression,onChange:g=>{f(h=>{var F;return{...h,[m]:{...h[m],generate_prompt:((F=h[m])==null?void 0:F.generate_prompt)??W.generate_prompt,generate_impression:g.target.value}}})},style:{width:"100%",height:600,marginBottom:12,fontSize:"16px",fontFamily:"'JetBrains Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace",backgroundColor:"transparent",color:"#fff",border:"none",outline:"none",resize:"none"},placeholder:"Impression Logic"})})]})}function Ge(){const[i,C]=r.useState(null),[x,m]=r.useState(!0);return r.useEffect(()=>{var Z,f;(async()=>{var b,k;try{const y=await((b=window.electronAPI)==null?void 0:b.authGetUser());C(((k=y==null?void 0:y.data)==null?void 0:k.user)||null)}catch(y){console.error("❌ Failed to get initial user:",y),C(null)}finally{m(!1)}})(),(async()=>{var b;try{await((b=window.electronAPI)==null?void 0:b.authSetupListener())}catch(k){console.error("❌ Failed to setup auth listener:",k)}})();const E=({event:b,session:k})=>{C((k==null?void 0:k.user)??null),m(!1)};return(f=(Z=window.electronAPI)==null?void 0:Z.onAuthStateChange)==null||f.call(Z,E),()=>{}},[]),{user:i,loading:x}}function Xe({text:i,onChange:C,disabled:x,className:m,style:I,onMouseUp:T}){var ae;const E=r.useRef(null);r.useRef(null);const[Z,f]=r.useState(!1),[b,k]=r.useState([]),[y,L]=r.useState(null),[M,O]=r.useState(null),[W,g]=r.useState(!1),[h,F]=r.useState(""),[S,$]=r.useState(0),[B,v]=r.useState(0),[U,V]=r.useState(null),[P,Y]=r.useState({position:0,visible:!1}),[p,R]=r.useState(!1),[G,X]=r.useState(!1),ee=r.useCallback(l=>{const c=l.match(/IMPRESSION:?\s*([\s\S]*?)(?:\n\n[A-Z]+:|$)/i);if(!c)return{items:[],hasImpression:!1};const d=c[1].trim(),w=[],H=[...d.matchAll(/^(\d+)\.\s*(.*?)(?=\n\d+\.\s|\n\n|$)/gms)];if(H.length>0)return H.forEach((u,J)=>{w.push({id:`item-${J}`,content:u[2].trim().replace(/\n\s*\n/g,`
`),originalIndex:J})}),{items:w,hasImpression:!0};const se=[...d.matchAll(/^[•\-\*]\s*(.*?)(?=\n[•\-\*]\s|\n\n|$)/gms)];if(se.length>0)return se.forEach((u,J)=>{w.push({id:`item-${J}`,content:u[1].trim().replace(/\n\s*\n/g,`
`),originalIndex:J})}),{items:w,hasImpression:!0};const te=d.split(/\n\s*\n+/).filter(u=>u.trim());return te.length>1?(te.forEach((u,J)=>{w.push({id:`item-${J}`,content:u.trim(),originalIndex:J})}),{items:w,hasImpression:!0}):{items:[],hasImpression:!0}},[]);r.useEffect(()=>{const{items:l}=ee(i);k(l)},[i,ee]);const le=r.useCallback(()=>{if(!E.current||x)return;const l=E.current,c=l.selectionStart,d=l.selectionEnd;if(c!==d){const w=i.substring(c,d);F(w),$(c),v(d)}else F("")},[i,x]),be=r.useCallback(l=>{if(x||!h)return;const c=E.current,d=c.selectionStart,w=c.selectionEnd;d<B&&w>S&&(g(!0),X(!0),V({x:l.clientX,y:l.clientY,text:h}),l.preventDefault())},[x,h,S,B]),Se=r.useCallback(l=>{var ge;if(!W||!E.current)return;V(oe=>oe?{...oe,x:l.clientX,y:l.clientY}:null);const c=E.current,d=c.getBoundingClientRect(),w=l.clientX-d.left,H=l.clientY-d.top;if(w<0||w>d.width||H<0||H>d.height){R(!0),Y({position:0,visible:!1});return}R(!1);const te=20,u=7.5,J=c.scrollTop,ce=c.scrollLeft,K=Math.floor((H+J)/te),ue=Math.floor((w+ce)/u),fe=i.split(`
`);let ne=0;for(let oe=0;oe<K&&oe<fe.length;oe++)ne+=fe[oe].length+1;ne+=Math.min(ue,((ge=fe[K])==null?void 0:ge.length)||0),ne=Math.max(0,Math.min(ne,i.length)),ne<S||ne>B?Y({position:ne,visible:!0}):Y({position:0,visible:!1})},[W,i,S,B]),ve=r.useCallback(l=>{if(W){if(p){const c=i.substring(0,S),d=i.substring(B),w=c+d;C(w),setTimeout(()=>{E.current&&(E.current.setSelectionRange(S,S),E.current.focus())},0)}else if(P.visible){let c;if(P.position<S){i.substring(0,S);const d=i.substring(B);c=i.substring(0,P.position)+h+i.substring(P.position,S)+d}else{const d=i.substring(0,S);i.substring(B),c=d+i.substring(B,P.position)+h+i.substring(P.position)}C(c),setTimeout(()=>{if(E.current){const d=P.position<S?P.position:P.position-(B-S);E.current.setSelectionRange(d,d+h.length)}},0)}}g(!1),V(null),Y({position:0,visible:!1}),R(!1),X(!1),T&&T(l)},[W,p,P,i,h,S,B,C,T]),N=r.useCallback(l=>{var ce;if(l.length===0)return i;const c=i.match(/IMPRESSION:?\s*([\s\S]*?)(?:\n\n[A-Z]+:|$)/i);if(!c)return i;const d=i.substring(0,c.index),w=i.substring(c.index+c[0].length),H=c[1].trim(),se=/^\d+\./.test(H),te=/^[•\-\*]/.test(H);let u="";se?u=l.map((K,ue)=>`${ue+1}. ${K.content}`).join(`

`):te?u=l.map(K=>`• ${K.content}`).join(`

`):u=l.map(K=>K.content).join(`

`);const J=((ce=c[0].match(/IMPRESSION:?\s*/i))==null?void 0:ce[0])||`IMPRESSION:
`;return d+J+u+(w?`

`+w:"")},[i]),de=r.useCallback((l,c)=>{if(l===c)return;const d=[...b],[w]=d.splice(l,1);d.splice(c,0,w),k(d);const H=N(d);C(H)},[b,N,C]),we=(l,c)=>{L(c),l.dataTransfer.effectAllowed="move"},Ie=(l,c)=>{l.preventDefault(),l.dataTransfer.dropEffect="move",O(c)},re=(l,c)=>{if(l.preventDefault(),!y||y===c){L(null),O(null);return}const d=b.findIndex(H=>H.id===y),w=b.findIndex(H=>H.id===c);de(d,w),L(null),O(null)},me=l=>{l>0&&de(l,l-1)},pe=l=>{l<b.length-1&&de(l,l+1)},{hasImpression:je}=ee(i);return Z&&b.length>0?e.jsxs("div",{style:{position:"relative",...I},children:[e.jsxs("div",{style:{background:"rgba(58, 188, 150, 0.1)",border:"1px solid rgba(58, 188, 150, 0.3)",borderRadius:"8px 8px 0 0",padding:"8px 12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{color:"#3ABC96",fontSize:"12px",fontWeight:500},children:"Reorder Impression Items"}),e.jsx("button",{onClick:()=>f(!1),style:{background:"transparent",border:"none",color:"#3ABC96",cursor:"pointer",fontSize:"12px"},children:"Done"})]}),e.jsx("div",{style:{background:(I==null?void 0:I.backgroundColor)||"transparent",border:"1px solid rgba(58, 188, 150, 0.3)",borderTop:"none",borderRadius:"0 0 8px 8px",padding:"12px",height:(ae=I==null?void 0:I.height)!=null&&ae.replace("px","")?`calc(${I.height} - 40px)`:"360px",overflowY:"auto"},children:b.map((l,c)=>e.jsx("div",{draggable:!0,onDragStart:d=>we(d,l.id),onDragOver:d=>Ie(d,l.id),onDrop:d=>re(d,l.id),style:{backgroundColor:M===l.id?"rgba(58, 188, 150, 0.2)":y===l.id?"rgba(58, 188, 150, 0.15)":"rgba(255, 255, 255, 0.05)",border:`1px solid ${M===l.id||y===l.id?"rgba(58, 188, 150, 0.5)":"rgba(255, 255, 255, 0.1)"}`,borderRadius:"6px",padding:"12px",marginBottom:"8px",cursor:y===l.id?"grabbing":"grab",opacity:y===l.id?.7:1,transition:"all 0.2s ease",color:"#fff",fontSize:"13px",lineHeight:"1.4"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[e.jsx("div",{style:{minWidth:"20px",height:"20px",backgroundColor:"rgba(58, 188, 150, 0.2)",borderRadius:"4px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",color:"#3ABC96",fontWeight:600},children:c+1}),e.jsx("div",{style:{flex:1},children:l.content}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"2px"},children:[e.jsx("button",{onClick:()=>me(c),disabled:c===0,style:{background:c===0?"rgba(255, 255, 255, 0.05)":"rgba(58, 188, 150, 0.1)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"3px",color:c===0?"#666":"#3ABC96",cursor:c===0?"not-allowed":"pointer",padding:"2px 6px",fontSize:"10px"},children:"↑"}),e.jsx("button",{onClick:()=>pe(c),disabled:c===b.length-1,style:{background:c===b.length-1?"rgba(255, 255, 255, 0.05)":"rgba(58, 188, 150, 0.1)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"3px",color:c===b.length-1?"#666":"#3ABC96",cursor:c===b.length-1?"not-allowed":"pointer",padding:"2px 6px",fontSize:"10px"},children:"↓"})]})]})},l.id))})]}):e.jsxs("div",{style:{position:"relative",display:"inline-block",width:"100%"},children:[e.jsx("textarea",{ref:E,value:i,onChange:l=>C(l.target.value),onSelect:le,onMouseDown:be,onMouseMove:Se,onMouseUp:ve,disabled:x,className:m,style:{...I,cursor:W?"grabbing":h?"grab":"text",userSelect:W?"none":"text",whiteSpace:"pre-wrap",wordWrap:"break-word"}}),U&&e.jsxs("div",{style:{position:"fixed",top:U.y+10,left:U.x+10,background:p?"rgba(227, 103, 86, 0.9)":"rgba(58, 188, 150, 0.9)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",maxWidth:"200px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",pointerEvents:"none",zIndex:1e4,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",transition:"background 0.2s ease"},children:[p?"🗑️ ":"",U.text.length>30?U.text.substring(0,30)+"...":U.text]}),P.visible&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:1},children:e.jsx("div",{style:{position:"absolute",top:"50%",left:"20px",width:"2px",height:"20px",background:"#3ABC96",borderRadius:"1px",boxShadow:"0 0 4px rgba(58, 188, 150, 0.5)"}})}),G&&e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,pointerEvents:"none",zIndex:9999},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,border:p?"3px solid #E36756":"3px dashed rgba(227, 103, 86, 0.5)",background:p?"rgba(227, 103, 86, 0.1)":"transparent",transition:"all 0.2s ease"}}),e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:p?"#E36756":"rgba(227, 103, 86, 0.8)",color:"white",padding:"16px 24px",borderRadius:"12px",fontSize:"18px",fontWeight:600,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",transition:"all 0.2s ease",scale:p?"1.1":"1"},children:p?"🗑️ Release to Delete":"🗑️ Drag here to delete"})]}),e.jsxs("div",{style:{position:"absolute",top:"8px",right:"8px",display:"flex",gap:"4px"},children:[h&&!W&&e.jsx("div",{style:{background:"rgba(58, 188, 150, 0.2)",border:"1px solid rgba(58, 188, 150, 0.3)",borderRadius:"4px",color:"#3ABC96",padding:"2px 6px",fontSize:"10px",fontWeight:500},children:"Drag to move or delete"}),je&&b.length>0&&e.jsx("button",{onClick:()=>f(!0),style:{background:"rgba(58, 188, 150, 0.2)",border:"1px solid rgba(58, 188, 150, 0.3)",borderRadius:"4px",color:"#3ABC96",cursor:"pointer",padding:"4px 8px",fontSize:"10px",fontWeight:500,zIndex:11},title:"Reorder impression items",children:"⋮⋮ Reorder"})]})]})}function Ze(){const[i,C]=r.useState("unknown"),[x,m]=r.useState(""),[I,T]=r.useState(""),[E,Z]=r.useState(!0),{user:f,loading:b}=Ge(),[k,y]=r.useState(!1),[L,M]=r.useState(""),[O,W]=r.useState(null),[g,h]=r.useState(""),[F,S]=r.useState(""),[$,B]=r.useState(""),[v,U]=r.useState(!1),[V,P]=r.useState([]),[Y,p]=r.useState([]),[R,G]=r.useState(350),[X,ee]=r.useState(160),[le,be]=r.useState(400),[Se,ve]=r.useState(""),[N,de]=r.useState(""),[we,Ie]=r.useState(!1),[re,me]=r.useState(160),[pe,je]=r.useState(null),[ae,l]=r.useState(null),[c,d]=r.useState(!1),[w,H]=r.useState(void 0),[se,te]=r.useState(!1),u=(t,s)=>{W({message:t,type:s}),setTimeout(()=>W(null),3e3)};r.useEffect(()=>{const t=o=>{var a,A;return console.error("Global error caught:",o.error),o.preventDefault(),(A=(a=o.error)==null?void 0:a.message)!=null&&A.includes("fetch")||u("An error occurred but was handled gracefully.","error"),!0},s=o=>{var a,A;return console.error("Unhandled promise rejection:",o.reason),o.preventDefault(),(A=(a=o.reason)==null?void 0:a.message)!=null&&A.includes("fetch")||u("An error occurred but was handled gracefully.","error"),!0};return window.addEventListener("error",t),window.addEventListener("unhandledrejection",s),()=>{window.removeEventListener("error",t),window.removeEventListener("unhandledrejection",s)}},[]),r.useEffect(()=>{const t=localStorage.getItem("colorScheme");t&&(t==="venice-blue"||t==="dark-ocean"||t==="lawrencium"||t==="deep-space"||t==="void-black"||t==="yoda")?(document.body.className=document.body.className.replace(/color-scheme-[\w-]+/g,""),document.body.classList.add(`color-scheme-${t}`)):(document.body.className=document.body.className.replace(/color-scheme-[\w-]+/g,""),document.body.classList.add("color-scheme-void-black"))},[]);const J=t=>t.replace(/~~([^~]+)~~/g,"").replace(/—+/g,"").replace(/\n\s*\n\s*\n/g,`

`).trim(),ce=async()=>{var t,s,o;if(!g.trim()){u("Please enter refinement instructions","error");return}if(!v){U(!0);try{if(!window.electronAPI){console.error("electronAPI not available"),u("API not available","error"),U(!1);return}const a=J(L||x),A=i==="impression-only",D=A?"refine_impression":"refine_report";console.log("Reading refinement prompt:",D);let _;try{_=await window.electronAPI.readPrompt(D)}catch(q){console.error("Error reading refinement template:",q),u("Could not read refinement template","error"),U(!1);return}if(!_||_.trim()===""){console.error("Refinement template is empty or not found"),u("Refinement template not found","error"),U(!1);return}const Q=_.replace("{{REFINEMENT_INPUT}}",g.trim()).replace(A?"{{IMPRESSION_TEXT}}":"{{REPORT_TEXT}}",a);console.log("Calling generateReport with refinement prompt");let j;try{j=await window.electronAPI.generateReport(Q)}catch(q){console.error("Error calling generateReport:",q),u("Failed to generate refinement","error"),U(!1);return}if(j){const q=typeof j=="string"?j:j.text,ye=typeof j=="string"?null:j.tokens,ie=x,Ce=F;B(ie),Ce||S(ie),P(xe=>[...xe,ie]),p([]),m(q),M(q),ye&&l(ye),h(""),u("Report refined successfully!","success")}else u("Failed to refine report","error")}catch(a){console.error("Refinement error:",a),u(`Error during refinement: ${(a==null?void 0:a.message)||a}`,"error"),((t=a==null?void 0:a.message)!=null&&t.includes("window")||(s=a==null?void 0:a.message)!=null&&s.includes("close"))&&(console.error("Window close prevented during refinement error"),(o=a.preventDefault)==null||o.call(a))}finally{U(!1)}}},K=()=>{if(V.length===0){u("No refinements to undo","error");return}const t=V[V.length-1];p(s=>[...s,x]),P(s=>s.slice(0,-1)),setTimeout(()=>{V.length>1?B(V[V.length-2]):B(""),m(t),M(t),u("Refinement undone","success")},10)},ue=()=>{if(Y.length===0){u("No refinements to redo","error");return}const t=Y[Y.length-1];P(s=>[...s,x]),p(s=>s.slice(0,-1)),setTimeout(()=>{B(x),m(t),M(t),u("Refinement redone","success")},10)},fe=async()=>{var t,s;if(console.log("🎯 handleOpenLogicEditor called, studyType:",N,"user:",f==null?void 0:f.id),!N){u("Study type not available for logic editing","error");return}if(!(f!=null&&f.id)){u("User authentication required for logic editing","error");return}try{console.log("📤 Sending IPC message to open logic editor:",{userId:f.id,studyType:N});const o=await((s=(t=window.electron)==null?void 0:t.ipcRenderer)==null?void 0:s.invoke("open-logic-editor",{userId:f.id,studyType:N}));console.log("📨 IPC result:",o),u(`✨ Opening logic editor for ${N}`,"success")}catch(o){console.error("❌ Error opening logic editor:",o),u("Error opening logic editor","error")}},ne=(t,s)=>{const o=Q=>Q.replace(/[ \t]+/g," "),a=o(t),A=o(s),D=Oe(a,A),_=[];for(let Q=0;Q<D.length;Q++){const j=D[Q];if(D[Q+1],j.value.match(/^[.,:;!?]\s*$/)&&!j.added&&!j.removed&&_.length>0){const q=_[_.length-1];if(q.added===j.added&&q.removed===j.removed){q.value+=j.value;continue}}if(j.value.trim()===""&&j.value.length>1){j.value.includes(`
`)?_.push(j):_.push({...j,value:" "});continue}if(j.value.includes(`
`)){_.push(j);continue}_.push(j)}return _},ge=r.useMemo(()=>{if(i!=="gpt-diff"||!x)return null;const t=$||I;if(!t)return null;const s=t.trim(),o=x.trim();return ne(s,o)},[i,I,x,$]),oe=t=>{const s=t.value.includes(`
`),o=t.value.trim()==="",a={padding:s||o?"0":"2px 4px",margin:s||o?"0":"0 1px",borderRadius:s||o?"0":"3px",display:"inline",lineHeight:"1.4",fontSize:"14px",fontFamily:"monospace",whiteSpace:"pre-wrap",verticalAlign:"baseline"};return t.added?{...a,backgroundColor:s||o?"transparent":"#0d4f2a",color:s||o?"#e5e7eb":"#4ade80",fontWeight:s||o?"normal":"600",border:s||o?"none":"1px solid #16a34a"}:t.removed?{...a,backgroundColor:s||o?"transparent":"#5c1f1f",color:s||o?"#e5e7eb":"#f87171",textDecoration:s||o?"none":"line-through",fontWeight:s||o?"normal":"600",border:s||o?"none":"1px solid #dc2626",opacity:s||o?"1":"0.8"}:{...a,backgroundColor:"transparent",color:"#e5e7eb",border:"none",margin:0,padding:0}},Be=()=>{const t=document.querySelector("[contenteditable]");t&&(t.querySelectorAll('span[style*="line-through"]').forEach(o=>o.remove()),M(t.innerText))},ke=Pe(f,i==="template-manager"||i==="logic-manager",se),Te=k?ke.templates:{},Re=k?ke.saveTemplate:()=>{},Ee=k?ke.refetchTemplates:async()=>{};r.useEffect(()=>{var t,s,o,a,A,D,_,Q,j,q,ye,ie,Ce,xe,ze;(s=(t=window.electronAPI)==null?void 0:t.getTextboxSize)==null||s.call(t,"diffBoxHeight").then(n=>{n&&G(n)}),(a=(o=window.electronAPI)==null?void 0:o.getTextboxSize)==null||a.call(o,"refinementBoxHeight").then(n=>{n&&ee(n)}),(D=(A=window.electronAPI)==null?void 0:A.getTextboxSize)==null||D.call(A,"mainTextareaHeight").then(n=>{n&&be(n)}),(Q=(_=window.electronAPI)==null?void 0:_.getTextboxSize)==null||Q.call(_,"feedbackBoxHeight").then(n=>{n&&me(n)}),(q=(j=window.electron)==null?void 0:j.ipcRenderer)==null||q.invoke("get-supabase-session").then(n=>{n?(console.log("🧠 Setting Supabase session in popup"),He.auth.setSession(n)):console.warn("⚠️ No Supabase session received in popup")}),(ye=window.electronAPI)==null||ye.onPopupContent(n=>{if(console.log("📥 popup-content received:",JSON.stringify(n,null,2)),console.log("📥 popup-content data type:",typeof n),console.log("📥 popup-content keys:",n?Object.keys(n):"null/undefined"),n!=null&&n.studyType&&de(n.studyType),n!=null&&n.generationTime&&je(n.generationTime),n!=null&&n.totalTokens&&l(n.totalTokens),(n==null?void 0:n.type)==="template-manager")y(!0),C("template-manager"),te(n.isOfflineMode||!1);else if((n==null?void 0:n.type)==="logic-manager")y(!0),C("logic-manager"),te(n.isOfflineMode||!1);else if((n==null?void 0:n.type)==="impression-only")C("impression-only"),m(n.result||""),M(n.result||"");else if((n==null?void 0:n.type)==="report-only")C("report-only"),m(n.result||""),M(n.result||"");else if((n==null?void 0:n.mode)==="template-viewer")C("template-viewer"),de(n.studyType||""),T(n.template||""),m(""),M("");else if(typeof n=="object"&&n.template&&n.result){const Me=n.showDiffView!==!1;Z(Me),C(Me?"gpt-diff":"report-only"),T(n.template),m(n.result),M(n.result)}else(n==null?void 0:n.type)==="loading"?C("loading"):C("unknown")}),(Ce=(ie=window.electronAPI)==null?void 0:ie.onPopupTokens)==null||Ce.call(ie,n=>{console.log("📊 popup-tokens received:",JSON.stringify(n,null,2)),n!=null&&n.generationTime&&je(n.generationTime),n!=null&&n.totalTokens&&l(n.totalTokens)}),(ze=(xe=window.electronAPI)==null?void 0:xe.onWindowFocus)==null||ze.call(xe,n=>{document.body.classList.toggle("radpal-focused",n)})},[]),r.useEffect(()=>{i==="gpt-diff"&&x&&M(x)},[i,x]);const he=e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{onClick:()=>window.electron.ipcRenderer.send("minimize-popup"),style:{fontSize:"13px",width:24,height:24,borderRadius:4,background:"#1c1e23",color:"#ccc",border:"none"},children:"–"}),e.jsx("button",{onClick:()=>window.electron.ipcRenderer.send("close-popup"),style:{fontSize:"13px",width:24,height:24,borderRadius:4,background:"#E36756",color:"#fff",border:"none"},children:"×"})]}),Fe=()=>i==="loading"?e.jsxs("div",{className:"popup-container",style:{height:"100vh",overflowY:"auto"},children:[e.jsx("div",{style:{height:"30px",backgroundColor:"transparent",WebkitAppRegion:"drag",position:"sticky",top:0,zIndex:1e3,display:"flex",justifyContent:"flex-end",alignItems:"center",paddingRight:"10px"},onDoubleClick:t=>t.preventDefault(),children:e.jsx("div",{style:{WebkitAppRegion:"no-drag"},children:he})}),e.jsx("div",{style:{padding:"20px",fontFamily:"Inter, sans-serif",fontWeight:600,fontSize:"16px",color:"#1a202c",textShadow:"none",paddingTop:"10px"},children:e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",minHeight:"calc(100vh - 70px)"},children:e.jsx("span",{style:{fontSize:14,opacity:.8,fontFamily:"'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif",fontWeight:400,color:"#1a202c",textShadow:"none"},children:"⟳ Generating..."})})})]}):i==="template-manager"?e.jsx("div",{className:"window-frame",children:e.jsxs("div",{style:{height:"100vh",overflowY:"auto",scrollbarWidth:"none",msOverflowStyle:"none"},children:[e.jsx("div",{style:{height:"30px",backgroundColor:"transparent",WebkitAppRegion:"drag",position:"sticky",top:0,zIndex:1e3,display:"flex",justifyContent:"flex-end",alignItems:"center",paddingRight:"10px"},onDoubleClick:t=>t.preventDefault(),children:e.jsx("div",{style:{WebkitAppRegion:"no-drag"},children:he})}),e.jsx("div",{style:{padding:20,fontFamily:"'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif",fontWeight:400,fontSize:"16px",color:"#1a202c",textShadow:"none",paddingTop:"10px"},children:e.jsx(Ue,{templates:Te,isOfflineMode:se,onSave:(t,s,o,a)=>{console.log("💾 Attempting to save:",t),Re(t,s,o,a).then(()=>u("✓ Saved!","success")).catch(A=>{console.error("❌ Save failed",A),u("✗ Save failed","error")})},onSaveWithAgentLogic:async(t,s,o)=>{var a,A;console.log("💾 Attempting to save new study type with agent logic:",t);try{const D=await((A=(a=window.electron)==null?void 0:a.ipcRenderer)==null?void 0:A.invoke("save-template-with-agent-logic",{userId:f==null?void 0:f.id,studyType:t,template:s,agentLogic:o}));if(D!=null&&D.success)u(`✓ Created "${t}" successfully!`,"success"),await Ee();else throw new Error((D==null?void 0:D.error)||"Save failed")}catch(D){throw console.error("❌ Save with agent logic failed",D),u("✗ Failed to create study type","error"),D}}})})]})}):i==="template-viewer"?e.jsx("div",{className:"window-frame",children:e.jsxs("div",{style:{height:"100vh",overflowY:"auto",backgroundColor:"#1e1f25",color:"#fff"},children:[e.jsxs("div",{style:{height:"40px",backgroundColor:"#2a2d31",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 15px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs("div",{style:{fontSize:"14px",fontWeight:600,color:"#3ABC96"},children:["📄 Template Viewer: ",N]}),e.jsx("button",{onClick:()=>window.close(),style:{background:"none",border:"none",color:"#999",fontSize:"20px",cursor:"pointer",padding:"4px 8px",lineHeight:1,transition:"color 0.2s ease"},onMouseEnter:t=>t.currentTarget.style.color="#fff",onMouseLeave:t=>t.currentTarget.style.color="#999",children:"×"})]}),e.jsx("div",{style:{padding:"20px",fontFamily:"monospace",fontSize:"14px",lineHeight:"1.6"},children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",margin:0,color:"#ccc",backgroundColor:"rgba(0, 0, 0, 0.2)",padding:"20px",borderRadius:"8px",border:"1px solid rgba(255, 255, 255, 0.1)"},children:I||"No template available"})}),e.jsxs("div",{style:{padding:"10px 20px",borderTop:"1px solid rgba(255, 255, 255, 0.1)",fontSize:"12px",color:"#666",textAlign:"center"},children:["This is a read-only view of the template for ",N]})]})}):i==="logic-manager"?e.jsx("div",{className:"window-frame",children:e.jsxs("div",{style:{height:"100vh",overflowY:"auto",scrollbarWidth:"none",msOverflowStyle:"none"},children:[e.jsx("div",{style:{height:"30px",backgroundColor:"transparent",WebkitAppRegion:"drag",position:"sticky",top:0,zIndex:1e3,display:"flex",justifyContent:"flex-end",alignItems:"center",paddingRight:"10px"},onDoubleClick:t=>t.preventDefault(),children:e.jsx("div",{style:{WebkitAppRegion:"no-drag"},children:he})}),e.jsx("div",{style:{padding:20,fontFamily:"'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif",fontWeight:400,fontSize:"16px",color:"#1a202c",textShadow:"none",paddingTop:"10px"},children:e.jsx(Ye,{templates:Te,onSave:(t,s,o,a)=>{console.log("💾 Attempting to save logic:",t),Re(t,s,o,a).then(()=>u("✓ Saved!","success")).catch(A=>{console.error("❌ Save failed",A),u("✗ Save failed","error")})}})})]})}):i==="gpt-diff"?e.jsxs("div",{className:"popup-container",style:{height:"100vh",overflowY:"auto"},children:[e.jsx("div",{style:{height:"30px",backgroundColor:"transparent",WebkitAppRegion:"drag",position:"sticky",top:0,zIndex:1e3,display:"flex",justifyContent:"flex-end",alignItems:"center",paddingRight:"10px"},onDoubleClick:t=>t.preventDefault(),children:e.jsx("div",{style:{WebkitAppRegion:"no-drag"},children:he})}),e.jsx("div",{style:{padding:"20px",fontFamily:"Inter, sans-serif",fontWeight:600,fontSize:"16px",color:"#1a202c",textShadow:"none",paddingTop:"10px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[e.jsx("div",{style:{display:"flex",gap:8,alignItems:"center"},children:e.jsx(z,{children:e.jsx("button",{className:"radpal-button radpal-button-remove",onClick:Be,style:{border:"none"},children:"✖ Remove Strikeouts"})})}),e.jsxs("div",{style:{display:"flex",gap:16,alignItems:"center"},children:[pe&&e.jsxs("span",{style:{fontSize:14,color:"#fff",textShadow:"none",fontFamily:"'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif",fontWeight:400},children:["Time: ",pe,"s"]}),ae&&e.jsxs("span",{style:{fontSize:14,color:"#fff",textShadow:"none",fontFamily:"'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif",fontWeight:400},children:["Tokens: ",ae.total.toLocaleString()]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx(z,{children:e.jsx("button",{className:"radpal-button radpal-button-impression",onClick:()=>navigator.clipboard.writeText(L||x),style:{border:"none"},children:"↗ Copy to Clipboard"})}),e.jsx(z,{children:e.jsxs("button",{onClick:()=>{H(void 0),d(!0)},className:"radpal-button",style:{backgroundColor:"#3b82f6",border:"none",width:"100%"},children:[e.jsx(Ae,{size:16,style:{verticalAlign:"middle",marginRight:"4px"}}),"Ask AI"]})})]})]})]})}),e.jsx("div",{contentEditable:!0,suppressContentEditableWarning:!0,className:"popup-diff-box",onInput:t=>M(t.currentTarget.innerText),style:{backgroundColor:"#1e1f25",border:"none",borderRadius:"8px",padding:"16px",minHeight:"200px",maxHeight:"600px",height:`${R}px`,resize:"none",overflowY:"auto",lineHeight:"1.6",fontSize:"14px",fontFamily:"monospace",whiteSpace:"pre-wrap",wordBreak:"break-word"},onMouseUp:()=>{var s,o;const t=document.querySelector(".popup-diff-box");if(t){const a=parseInt(getComputedStyle(t).height);a!==R&&(G(a),(o=(s=window.electronAPI)==null?void 0:s.saveTextboxSize)==null||o.call(s,"diffBoxHeight",a))}},children:e.jsx("div",{style:{display:"inline"},children:v?e.jsx("span",{style:{fontSize:14,opacity:.8,color:"#fff"},children:"⟳ Generating..."}):(ge==null?void 0:ge.map((t,s)=>e.jsx("span",{style:oe(t),children:t.value},`diff-${s}-${t.added?"add":t.removed?"rem":"same"}`)))||e.jsx("span",{children:"No differences to show"})})},`diff-${x.length}-${$.length}`),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:80},children:e.jsxs("div",{style:{width:"95%",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,zIndex:10,transform:"translateY(-130%)",marginBottom:20},children:e.jsx(z,{children:e.jsx("button",{onClick:ce,disabled:v||!g.trim(),className:"radpal-button radpal-button-impression",style:{opacity:v||!g.trim()?.5:1,backgroundColor:"#3ABC96",border:"none",fontSize:"12px",padding:"4px 8px"},children:v?"Refining...":"Refine Report"})})}),e.jsx("textarea",{value:g,onChange:t=>h(t.target.value),placeholder:"Describe how you'd like to improve the report... (e.g., 'make it more concise', 'change tone to more assertive', 'add details about disc desiccation')",disabled:v,className:"popup-output-textarea",style:{width:"95%",minHeight:`${X}px`,height:`${X}px`,resize:"none",padding:"16px",backgroundColor:"#1e1f25",color:"#fff",border:"none",borderRadius:"16px",fontSize:"18px",fontFamily:"monospace",lineHeight:"1.5",whiteSpace:"pre-wrap",margin:"0 auto",display:"block",outline:"none",boxSizing:"border-box"},onFocus:t=>t.currentTarget.style.borderColor="transparent",onBlur:t=>t.currentTarget.style.borderColor="transparent",onMouseUp:t=>{var o,a;const s=parseInt(getComputedStyle(t.currentTarget).height);s!==X&&(ee(s),(a=(o=window.electronAPI)==null?void 0:o.saveTextboxSize)==null||a.call(o,"refinementBoxHeight",s))}}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginTop:"10px"},children:e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[V.length>0&&e.jsx(z,{children:e.jsx("button",{onClick:K,disabled:v,className:"radpal-button radpal-button-remove",style:{opacity:v?.5:1,backgroundColor:"transparent",border:"none"},children:"↶ Undo"})}),Y.length>0&&e.jsx(z,{children:e.jsx("button",{onClick:ue,disabled:v,className:"radpal-button radpal-button-impression",style:{opacity:v?.5:1,backgroundColor:"transparent",border:"none"},children:"↷ Redo"})})]})})]})}),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:80},children:e.jsxs("div",{style:{width:"95%",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,zIndex:10,transform:"translateY(-130%)",marginBottom:20},children:e.jsx(z,{children:e.jsx("button",{onClick:fe,disabled:!N,className:"radpal-button radpal-button-impression",style:{opacity:N?1:.5,backgroundColor:"#3ABC96",border:"none",fontSize:"12px",padding:"4px 8px"},children:"⚡ Edit Logic"})})}),e.jsx("textarea",{value:Se,onChange:t=>ve(t.target.value),placeholder:"Click 'Edit Logic' to customize report generation rules...",disabled:we,className:"popup-output-textarea",style:{width:"95%",minHeight:`${re}px`,height:`${re}px`,resize:"none",padding:"16px",backgroundColor:"#1e1f25",color:"#fff",border:"none",borderRadius:"16px",fontSize:"18px",fontFamily:"monospace",lineHeight:"1.5",whiteSpace:"pre-wrap",margin:"0 auto",display:"block",outline:"none",boxSizing:"border-box"},onFocus:t=>t.currentTarget.style.borderColor="transparent",onBlur:t=>t.currentTarget.style.borderColor="transparent",onMouseUp:t=>{var o,a;const s=parseInt(getComputedStyle(t.currentTarget).height);s!==re&&(me(s),(a=(o=window.electronAPI)==null?void 0:o.saveTextboxSize)==null||a.call(o,"feedbackBoxHeight",s))}}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"20px"},children:e.jsx("div",{style:{fontSize:"16px",color:"#1a202c",textShadow:"none",fontFamily:"Inter, sans-serif",fontWeight:600},children:N?`Study Type: ${N}`:"Study type not detected"})})]})})]}):i==="impression-only"||i==="report-only"?e.jsxs("div",{className:"popup-container",style:{height:"100vh",overflowY:"auto"},children:[e.jsx("div",{style:{height:"30px",backgroundColor:"transparent",WebkitAppRegion:"drag",position:"sticky",top:0,zIndex:1e3,display:"flex",justifyContent:"flex-end",alignItems:"center",paddingRight:"10px"},onDoubleClick:t=>t.preventDefault(),children:e.jsx("div",{style:{WebkitAppRegion:"no-drag"},children:he})}),e.jsxs("div",{style:{padding:"20px",fontFamily:"Inter, sans-serif",fontWeight:600,fontSize:"16px",color:"#1a202c",textShadow:"none",paddingTop:"10px"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",marginBottom:12},children:e.jsxs("div",{style:{display:"flex",gap:16,alignItems:"center"},children:[pe&&e.jsxs("span",{style:{fontSize:14,color:"#fff",textShadow:"none",fontFamily:"'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif",fontWeight:400},children:["Time: ",pe,"s"]}),ae&&e.jsxs("span",{style:{fontSize:14,color:"#fff",textShadow:"none",fontFamily:"'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif",fontWeight:400},children:["Tokens: ",ae.total.toLocaleString()]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[e.jsx(z,{children:e.jsx("button",{className:"radpal-button radpal-button-impression",onClick:()=>navigator.clipboard.writeText(L),style:{border:"none"},children:"↗ Copy to Clipboard"})}),e.jsx(z,{children:e.jsxs("button",{onClick:()=>{H(void 0),d(!0)},className:"radpal-button",style:{backgroundColor:"#3b82f6",border:"none",width:"100%"},children:[e.jsx(Ae,{size:16,style:{verticalAlign:"middle",marginRight:"4px"}}),"Ask AI"]})})]})]})}),e.jsx(Xe,{text:v?"⟳ Generating...":L,onChange:t=>M(t),disabled:v,className:"popup-output-textarea",style:{marginBottom:"40px",opacity:v?.8:1,height:`${le}px`},onMouseUp:t=>{var o,a;const s=parseInt(getComputedStyle(t.currentTarget).height);s!==le&&(be(s),(a=(o=window.electronAPI)==null?void 0:o.saveTextboxSize)==null||a.call(o,"mainTextareaHeight",s))}}),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:80},children:e.jsxs("div",{style:{width:"95%",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,zIndex:10,transform:"translateY(-130%)",marginBottom:20},children:e.jsx(z,{children:e.jsx("button",{onClick:ce,disabled:v||!g.trim(),className:"radpal-button radpal-button-impression",style:{opacity:v||!g.trim()?.5:1,backgroundColor:"#3ABC96",border:"none",fontSize:"12px",padding:"4px 8px"},children:v?"Refining...":`Refine ${i==="impression-only"?"Impression":"Report"}`})})}),e.jsx("textarea",{value:g,onChange:t=>h(t.target.value),placeholder:`Describe how you'd like to improve the ${i==="impression-only"?"impression":"report"}... (e.g., 'make it more concise', 'change tone to more assertive', 'add details about disc desiccation')`,disabled:v,className:"popup-output-textarea",style:{backgroundColor:"#1e1f25",color:"#fff",border:"none",borderRadius:"16px",fontSize:"18px",fontFamily:"monospace",lineHeight:"1.5",minHeight:`${X}px`,maxHeight:"200px",height:`${X}px`,resize:"none",padding:"16px",marginBottom:"40px",outline:"none",boxSizing:"border-box"},onFocus:t=>t.currentTarget.style.borderColor="transparent",onBlur:t=>t.currentTarget.style.borderColor="transparent",onMouseUp:t=>{var o,a;const s=parseInt(getComputedStyle(t.currentTarget).height);s!==X&&(ee(s),(a=(o=window.electronAPI)==null?void 0:o.saveTextboxSize)==null||a.call(o,"refinementBoxHeight",s))}}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[V.length>0&&e.jsx(z,{children:e.jsx("button",{onClick:K,disabled:v,className:"radpal-button radpal-button-remove",style:{opacity:v?.5:1,backgroundColor:"transparent",border:"none"},children:"↶ Undo"})}),Y.length>0&&e.jsx(z,{children:e.jsx("button",{onClick:ue,disabled:v,className:"radpal-button radpal-button-impression",style:{opacity:v?.5:1,backgroundColor:"transparent",border:"none"},children:"↷ Redo"})})]})})]})}),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:80},children:e.jsxs("div",{style:{width:"95%",position:"relative"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,zIndex:10,transform:"translateY(-130%)",marginBottom:20},children:e.jsx(z,{children:e.jsx("button",{onClick:fe,disabled:!N,className:"radpal-button radpal-button-impression",style:{opacity:N?1:.5,backgroundColor:"#3ABC96",border:"none",fontSize:"12px",padding:"4px 8px"},children:"⚡ Edit Logic"})})}),e.jsx("textarea",{value:Se,onChange:t=>ve(t.target.value),placeholder:`Click 'Edit Logic' to customize ${i==="impression-only"?"impression":"report"} generation rules...`,disabled:we,className:"popup-output-textarea",style:{backgroundColor:"#1e1f25",color:"#fff",border:"none",borderRadius:"16px",fontSize:"18px",fontFamily:"monospace",lineHeight:"1.5",minHeight:`${re}px`,maxHeight:"200px",height:`${re}px`,resize:"none",padding:"16px",outline:"none",boxSizing:"border-box"},onFocus:t=>t.currentTarget.style.borderColor="transparent",onBlur:t=>t.currentTarget.style.borderColor="transparent",onMouseUp:t=>{var o,a;const s=parseInt(getComputedStyle(t.currentTarget).height);s!==re&&(me(s),(a=(o=window.electronAPI)==null?void 0:o.saveTextboxSize)==null||a.call(o,"feedbackBoxHeight",s))}}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"20px"},children:e.jsx("div",{style:{fontSize:"16px",color:"#1a202c",textShadow:"none",fontFamily:"Inter, sans-serif",fontWeight:600},children:N?`Study Type: ${N}`:"Study type not detected"})})]})})]})]}):e.jsxs("div",{style:{height:"100vh",overflowY:"auto",scrollbarWidth:"none",msOverflowStyle:"none"},children:[e.jsx("div",{style:{height:"30px",backgroundColor:"transparent",WebkitAppRegion:"drag",position:"sticky",top:0,zIndex:1e3,display:"flex",justifyContent:"flex-end",alignItems:"center",paddingRight:"10px"},children:e.jsx("div",{style:{WebkitAppRegion:"no-drag"},children:he})}),e.jsxs("div",{style:{padding:20,fontFamily:"Inter, sans-serif",fontWeight:600,fontSize:"16px",color:"#1a202c",textShadow:"none",paddingTop:"10px"},children:[e.jsx("h3",{style:{fontFamily:"Inter, sans-serif",fontWeight:600,fontSize:"16px",color:"#1a202c",textShadow:"none"},children:"⚠ Unknown popup content"}),e.jsx("p",{style:{fontFamily:"Inter, sans-serif",fontWeight:600,fontSize:"16px",color:"#1a202c",textShadow:"none"},children:"No matching content handler found."})]})]});return e.jsxs("div",{className:"window-frame",children:[Fe(),O&&e.jsx("div",{style:{position:"fixed",top:"60px",right:"20px",zIndex:10001,backgroundColor:O.type==="success"?"#0d4f2a":"#5c1f1f",color:O.type==="success"?"#4ade80":"#f87171",border:O.type==="success"?"1px solid #16a34a":"1px solid #dc2626",borderRadius:"8px",padding:"12px 16px",fontSize:"16px",fontFamily:"Inter, sans-serif",fontWeight:600,boxShadow:"none",animation:"slideIn 0.3s ease-out",maxWidth:"300px",wordBreak:"break-word"},children:O.message}),c&&(f==null?void 0:f.id)&&e.jsx(_e,{userId:f.id,studyType:N||"",reportText:L||x,reportId:void 0,sessionId:w,onClose:()=>d(!1)})]})}We.createRoot(document.getElementById("root")).render(e.jsx(Ze,{}));
